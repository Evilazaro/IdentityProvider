# This image definition sets up a development environment for backend engineers.
# It includes the following resources:
# - WinGet PowerShell module and related tools for package management.
# - Common engineering tools using a configuration file from a GitHub repository.
# - .NET SDK and Runtime for developing and running .NET applications.
# - Visual Studio Code and its extensions for code editing and development.
# The setup ensures a streamlined and consistent environment for backend development.

$schema: "1.0"
name: identityProvider-backend-engineer
image: microsoftvisualstudio_visualstudioplustools_vs-2022-ent-general-win11-m365-gen2

tasks:
  # PowerShell setup
  - name: ~/powershell
    parameters:
      command: |
        $progressPreference = 'silentlyContinue'
        Write-Host "Installing WinGet PowerShell module from PSGallery..."
        Set-ExecutionPolicy Bypass -Scope Process -Force
        Install-PackageProvider -Name NuGet -Scope AllUsers -Force | Out-Null
        Install-Module -Name Microsoft.WinGet.Client -Scope AllUsers -Force -Repository PSGallery | Out-Null
        Install-Module Microsoft.WinGet.Configuration -AllowPrerelease -Scope AllUsers -Force -Repository PSGallery | Out-Null
        winget configure --enable
        Write-Host "Using Repair-WinGetPackageManager cmdlet to bootstrap WinGet..."
        Repair-WinGetPackageManager
        Install-PackageProvider -Name NuGet -Scope AllUsers -Force | Out-Null
        Install-Module -Name PSDscResources -Scope AllUsers -Force -AllowClobber
        Write-Host "Done."
  
  # Install common engineer tools
  - name: ~/winget
    description: Install Common Engineer Tools
    parameters:
      downloadUrl: "https://raw.githubusercontent.com/Evilazaro/DevExp-DevBox/refs/heads/main/.configuration/devcenter/workloads/common-config.dsc.yaml"

  # Install DotNet SDK and Runtime
  - name: ~/winget
    description: Install DotNet SDK and Runtime
    parameters:
      downloadUrl: "https://raw.githubusercontent.com/Evilazaro/DevExp-DevBox/refs/heads/main/.configuration/devcenter/workloads/customizations/dotnet/dotnet.dsc.yaml"
  
  # Install VS Code and Its extensions
  - name: ~/winget
    description: Install VS Code and Its extensions
    parameters:
      downloadUrl: "https://raw.githubusercontent.com/Evilazaro/DevExp-DevBox/refs/heads/main/.configuration/devcenter/workloads/customizations/ides/vscode.dsc.yaml"